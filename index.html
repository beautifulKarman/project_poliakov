<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8">
  <title>Моє Портфоліо</title>

  <!-- Дозволяємо CDN-скрипти (Tailwind, Alpine) -->
  <meta http-equiv="Content-Security-Policy"
        content="default-src 'self' data:; script-src 'self' 'unsafe-inline' 'unsafe-eval' https://cdn.tailwindcss.com https://unpkg.com; style-src 'self' 'unsafe-inline'; img-src 'self' data:; connect-src 'self' https://matrix.org;">

  <!-- TailwindCSS & Alpine.js -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/alpinejs@3.x.x" defer></script>

  <style>
    /* Твої базові стилі */
    body {
      font-family: Arial, sans-serif;
      margin: 0; padding: 0;
      background-color: #f0f2f5;
    }
    .container {
      width: 90%; max-width: 900px;
      margin: 20px auto; padding: 20px;
      background-color: #ffffff;
      border-radius: 8px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.05);
    }
    h1, h2 {
      color: #333;
      border-bottom: 2px solid #007bff;
      padding-bottom: 5px;
    }
    ul { list-style-type: square; margin-left: 20px; }

    table { width: 100%; border-collapse: collapse; margin-top: 15px; }
    th, td { border: 1px solid #ddd; padding: 10px; text-align: left; }
    th { background-color: #f2f2f2; color: #555; }
    tr:nth-child(even) { background-color: #f9f9f9; }
    tr:hover { background-color: #eef6ff; }

    /* Для коректного приховування до ініціалізації Alpine */
    [x-cloak]{ display:none !important; }
  </style>
</head>

<!-- Каркас сторінки за завданням -->
<body class="bg-gray-100 flex items-center justify-center h-screen">
  <!-- Компонент Alpine -->
  <div x-data="chatApp()" class="bg-white p-6 rounded shadow-md w-96">

    <!-- Шаблон входу (показується поки немає токена) -->
    <template x-if="!accessToken">
      <div>
        <h2 class="text-xl font-bold mb-4">Login</h2>
        <input x-model="username" placeholder="Username"
               class="border p-2 w-full mb-2 rounded" />
        <input x-model="password" type="password" placeholder="Password"
               class="border p-2 w-full mb-2 rounded" />
        <button @click="login()"
                class="bg-blue-500 text-white p-2 w-full rounded">Login</button>
        <p x-text="error" class="text-red-500 mt-2"></p>
      </div>
    </template>

    <!-- Шаблон після успішної авторизації -->
    <template x-if="accessToken">
      <div>
        <h1 class="text-lg font-semibold mb-3">Ви успішно авторизувались. Ваша панель керування</h1>

        <!-- Розширена область панелі -->
        <div class="flex flex-col h-[550px]">
          <!-- User ID -->
          <div class="mb-2 p-2 bg-gray-200 rounded text-sm break-words">
            <span class="font-bold">Your Matrix ID:</span>
            <span x-text="userId ? userId : 'Loading...'"></span>
          </div>

          <!-- Блок «Резюме» -->
          <div class="mb-3 p-3 border rounded">
            <h2 class="text-base font-semibold mb-2">Резюме</h2>
            <div class="grid grid-cols-1 gap-2 text-sm">
              <div><span class="font-semibold">Ім’я:</span> Дмитро (приклад)</div>
              <div><span class="font-semibold">Роль:</span> Junior Frontend / Electron</div>
              <div><span class="font-semibold">Email:</span> your.email@example.com</div>
              <div><span class="font-semibold">Навички:</span> HTML5, CSS, Tailwind, Alpine.js, Electron, Python (Pandas)</div>
            </div>
          </div>

          <!-- Твоє портфоліо (інтегроване як є) -->
          <div class="container overflow-auto">
            <h1>Моє портфоліо</h1>
            <p>Вітаю! Це мій перший практичний проєкт в Electron.</p>

            <h2>Мої навички</h2>
            <ul>
              <li>HTML5 — Основи</li>
              <li>CSS — Базові стилі</li>
              <li>JavaScript — Початківець</li>
              <li>Electron — Встановлення та запуск</li>
            </ul>

            <h2>Мої проєкти</h2>
            <table>
              <thead>
                <tr>
                  <th>Назва проєкту</th>
                  <th>Технологія</th>
                  <th>Статус</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>Перший додаток</td>
                  <td>Electron.js</td>
                  <td>В процесі</td>
                </tr>
                <tr>
                  <td>Портфоліо</td>
                  <td>HTML/CSS</td>
                  <td>Готово</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div><!-- /flex -->
      </div>
    </template>
  </div>

  <!-- ЛОГІКА: локальна перевірка + авторизація на сервері Matrix -->
  <script>
    function chatApp() {
      return {
        username: '',
        password: '',
        accessToken: '',
        userId: '',
        error: '',

        async login() {
          this.error = '';

          // 1) Демонстраційна локальна перевірка (за вимогами завдання)
          if (this.username === 'admin' && this.password === '1234') {
            this.accessToken = 'token123';
            this.userId = '@admin:local';
            return;
          }

          // 2) Спроба реального логіну через Matrix API
          try {
            const res = await fetch('https://matrix.org/_matrix/client/r0/login', {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({
                type: 'm.login.password',
                user: this.username,
                password: this.password
              })
            });

            const data = await res.json();

            if (res.ok && data && data.access_token) {
              this.accessToken = data.access_token;
              this.userId = data.user_id || '';
            } else {
              this.error = this.localizeError((data && (data.error || data.errcode)) || 'Login failed');
            }
          } catch (e) {
            console.error(e);
            this.error = 'Помилка під час з’єднання. Перевірте інтернет або спробуйте пізніше.';
          }
        },

        localizeError(msg) {
          const m = ('' + msg).toUpperCase();
          if (m.includes('FORBIDDEN') || m.includes('M_FORBIDDEN')) return 'Невірний логін або пароль.';
          if (m.includes('UNAUTHORIZED') || m.includes('M_UNAUTHORIZED')) return 'Авторизація відхилена.';
          if (m.includes('BAD JSON') || m.includes('M_BAD_JSON')) return 'Невірний формат запиту.';
          if (m.includes('CAPTCHA')) return 'Потрібна CAPTCHA. Завершіть в офіційному клієнті.';
          if (m.includes('RATE LIMIT') || m.includes('M_LIMIT_EXCEEDED')) return 'Забагато спроб. Зачекайте та повторіть.';
          return 'Не вдалося увійти. Перевірте дані та спробуйте знову.';
        }
      }
    }
  </script>
</body>
</html>
